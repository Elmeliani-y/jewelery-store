# نظام Dusty لإدارة المجوهرات - دليل المستخدم

## نظرة عامة

نظام Dusty هو تطبيق Laravel متكامل لإدارة محلات المجوهرات مع نظام صلاحيات متعدد المستويات.

## أنواع المستخدمين والصلاحيات

### 1. المدير (Admin)

-   **اسم المستخدم:** `admin`
-   **كلمة المرور:** `admin123`
-   **الصفحة الرئيسية:** لوحة القيادة (Dashboard)
-   **الصلاحيات:**
    -   الوصول الكامل لجميع الميزات
    -   عرض وإدارة جميع الفروع
    -   عرض وإدارة جميع الموظفين
    -   عرض جميع المبيعات والنفقات
    -   إنشاء وعرض جميع التقارير

### 2. المحاسب (Accountant)

-   **اسم المستخدم:** `accountant`
-   **كلمة المرور:** `accountant123`
-   **الصفحة الرئيسية:** لوحة القيادة (Dashboard)
-   **الصلاحيات:**
    -   عرض لوحة القيادة مع جميع الإحصائيات
    -   عرض جميع المبيعات والنفقات
    -   إنشاء وعرض التقارير
    -   لا يرتبط بفرع معين

### 3. حساب الفرع (Branch Account)

-   **الحسابات المتاحة:**
    -   `branch1` / `branch123` - حساب الفرع الرئيسي
-   **الصفحة الرئيسية:** صفحة تسجيل فاتورة جديدة مباشرة
-   **الصلاحيات:**
    -   الوصول المباشر لصفحة إنشاء فاتورة
    -   الفرع محدد مسبقاً ولا يمكن تغييره
    -   عرض الموظفين التابعين للفرع فقط
    -   عرض مبيعات ونفقات الفرع فقط

## المميزات الرئيسية

### 1. التوجيه التلقائي بعد تسجيل الدخول

-   **المدير والمحاسب** ← لوحة القيادة
-   **حساب الفرع** ← صفحة تسجيل الفاتورة مباشرة

### 2. لوحة القيادة (Dashboard)

تعرض معلومات شاملة في الوقت الفعلي:

-   إجمالي المبيعات والصافي والضرائب
-   إجمالي الوزن المباع
-   إجمالي النفقات وصافي الربح
-   رسوم بيانية تفاعلية:
    -   المبيعات اليومية
    -   المبيعات حسب العيار
    -   المبيعات حسب الصنف
    -   المبيعات حسب الفرع
    -   النفقات حسب النوع
-   أفضل الأداءات:
    -   أفضل الفروع
    -   أفضل الموظفين
    -   أفضل الأصناف
    -   أفضل العيارات

### 3. إدارة المبيعات

-   تسجيل فواتير مبيعات كاملة
-   اختيار الفرع والموظف
-   تحديد الصنف والعيار
-   حساب تلقائي للضريبة والصافي
-   طرق دفع متعددة (نقدي، شبكة، مختلط)
-   استرجاع الفواتير
-   البحث والفلترة المتقدمة

### 4. إدارة النفقات

-   تسجيل النفقات حسب النوع
-   ربط النفقات بالفروع
-   تقارير تفصيلية عن النفقات

### 5. التقارير

-   تقرير شامل
-   تقرير تفصيلي
-   تقرير العيارات
-   تقرير الأصناف
-   تقرير الموظفين
-   تقرير صافي الربح

### 6. إدارة الفروع

-   إضافة وتعديل الفروع
-   تفعيل/تعطيل الفروع
-   عرض إحصائيات كل فرع

### 7. إدارة الموظفين

-   إضافة موظفين لكل فرع
-   تعديل بيانات الموظفين
-   تفعيل/تعطيل الموظفين

## التثبيت والإعداد

### متطلبات التشغيل

-   PHP 8.1 أو أحدث
-   MySQL/MariaDB
-   Composer
-   Node.js & NPM

### خطوات التشغيل

```bash
# 1. تثبيت المكتبات
composer install

# 2. نسخ ملف البيئة
cp .env.example .env

# 3. توليد مفتاح التطبيق
php artisan key:generate

# 4. تعديل إعدادات قاعدة البيانات في ملف .env

# 5. تشغيل الهجرات والبيانات الأولية
php artisan migrate:fresh --seed

# 6. تشغيل الخادم
php artisan serve
```

### الوصول للتطبيق

افتح المتصفح على: `http://127.0.0.1:8000`

## هيكل قاعدة البيانات

### الجداول الرئيسية

-   `users` - المستخدمين مع الأدوار
-   `branches` - الفروع
-   `employees` - الموظفين
-   `categories` - أصناف المجوهرات
-   `calibers` - عيارات الذهب
-   `expense_types` - أنواع النفقات
-   `sales` - المبيعات
-   `expenses` - النفقات

### العلاقات

-   User → Branch (belongsTo)
-   Branch → Users (hasMany)
-   Branch → Employees (hasMany)
-   Branch → Sales (hasMany)
-   Branch → Expenses (hasMany)
-   Employee → Branch (belongsTo)
-   Sale → Branch, Employee, Category, Caliber (belongsTo)
-   Expense → Branch, ExpenseType (belongsTo)

## الأمان والصلاحيات

### تشفير كلمات المرور

جميع كلمات المرور محفوظة بتشفير bcrypt آمن.

### التحقق من الصلاحيات

-   يتم التحقق من دور المستخدم عند تسجيل الدخول
-   الفلترة التلقائية للبيانات حسب الفرع لحسابات الفروع
-   حماية المسارات بـ middleware authentication

### Foreign Keys

جميع العلاقات محمية بـ foreign key constraints في قاعدة البيانات.

## الملفات الهامة

### Controllers

-   `DashboardController` - لوحة القيادة
-   `SaleController` - إدارة المبيعات
-   `ExpenseController` - إدارة النفقات
-   `BranchController` - إدارة الفروع
-   `EmployeeController` - إدارة الموظفين
-   `ReportController` - التقارير

### Models

-   `User` - المستخدم مع دوال الأدوار
-   `Branch`, `Employee`, `Sale`, `Expense`
-   `Category`, `Caliber`, `ExpenseType`

### Views

-   `dashboard/index.blade.php` - لوحة القيادة
-   `sales/create.blade.php` - تسجيل فاتورة
-   `auth/login.blade.php` - صفحة تسجيل الدخول

## التحديثات والصيانة

### إضافة مستخدم جديد

```php
User::create([
    'name' => 'اسم المستخدم',
    'email' => 'username',
    'password' => Hash::make('password'),
    'role' => 'branch', // admin, accountant, branch
    'branch_id' => 1, // null للمدراء والمحاسبين
]);
```

### إضافة فرع جديد

```php
$branch = Branch::create([
    'name' => 'اسم الفرع',
    'address' => 'العنوان',
    'phone' => '0123456789',
    'is_active' => true,
]);

// إنشاء حساب للفرع
User::create([
    'name' => 'حساب ' . $branch->name,
    'email' => 'branch' . $branch->id,
    'password' => Hash::make('branch123'),
    'role' => 'branch',
    'branch_id' => $branch->id,
]);
```

## الدعم الفني

للمساعدة والاستفسارات، يرجى مراجعة:

-   الكود المصدري في `app/` و `resources/`
-   ملفات الهجرة في `database/migrations/`
-   البيانات الأولية في `database/seeders/`

---

**آخر تحديث:** 20 نوفمبر 2025

**الإصدار:** 1.0.0

**الحالة:** جاهز للاستخدام ✅
